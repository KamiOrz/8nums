var eightNumsApp=angular.module("eightNumsApp",[]);eightNumsApp.filter("getWidth",function(){return function(a){return a%3}}).filter("getHeight",function(){return function(a){return parseInt(a/3)}});eightNumsApp.controller("mainPanel",["$scope","$timeout",function(a,b){a.filter={getWidth:function(d){return d%3},getHeight:function(d){return parseInt(d/3)}};a.event={random:function(){a.event.reset();var d=c.setRandom();console.log("source",d);a.sourcePosition=c.remap(d);a.showPosition=c.remap(d);a.targetPosition=c.remap(c.getTargetArr());a.hasSolution=c.hasSolution();a.event.solve()},solve:function(){a.result=c.getPath();if(a.result&&a.result.solve){a.showPosition=c.remap(a.result.path[0])}a.sourceIndex=0},next:function(){a.sourceIndex++;if(a.result&&a.result.solve&&a.sourceIndex<a.result.path.length){a.showPosition=c.remap(a.result.path[a.sourceIndex])}else{a.sourceIndex--;a.showMessage=true;b(function(){a.animateMessage=true},50);b(function(){a.animateMessage=false},2000);b(function(){a.showMessage=false},2400);return false}return true},reset:function(){a.animateMessage=false;b(function(){a.showMessage=false},400);if(a.result&&a.result.solve){a.showPosition=c.remap(a.result.path[0])}a.sourceIndex=0},auto:function(){if(a.async){return}a.async=true;d();function d(){if(a.event.next()){b(function(){d()},150)}else{a.async=false}}},pathView:function(e,d){a.holdMouseHover=true;a.tempIndex=d;a.showPosition=c.remap(a.result.path[a.tempIndex])},pathResume:function(){a.holdMouseHover=false;b(function(){if(a.holdMouseHover){return}a.showPosition=c.remap(a.result.path[a.sourceIndex])},500)},pathSelect:function(f,d){a.sourceIndex=d;a.showPosition=c.remap(a.result.path[a.sourceIndex]);try{a.$digest()}catch(g){}},keyControl:function(d){if(d.which===38){if(a.sourceIndex>0){a.event.pathSelect(null,a.sourceIndex-1)}d.preventDefault()}else{if(d.which===40){if(a.result&&a.result.path&&a.sourceIndex+1<a.result.path.length){a.event.pathSelect(null,a.sourceIndex+1)}d.preventDefault()}}},calcDir:function(e,g){var f=g,d=g+1;if(e.length<=d){return"="}var i=j(e[f]);var h=j(e[d]);if(i<h){if(h-i===1){return"←"}else{return"↑"}}else{if(i-h===1){return"→"}else{return"↓"}}function j(k){for(var l=0;l<9;l++){if(k[l]===0){return l}}return -1}}};var c=eightNums();a.event.random();a.event.solve();angular.element(document).on("keydown",a.event.keyControl)}]);function eightNums(){var q=388211;var s=[[0,4,0,2],[0,5,1,3],[0,6,2,0],[1,7,0,5],[2,8,4,6],[3,9,5,0],[4,0,0,8],[5,0,7,9],[6,0,8,0]];var p=[];var u={sta:0,pos:0,step:0,visit:0};var o={sta:0,pos:0,step:0,visit:0};var h,c;var f=[2,1,7,6,3,4,5,8,0];var m=[1,2,3,4,5,6,7,8,0];return{setRandom:t,getPath:j,remap:g,hasSolution:v,getSourceArr:l("s"),getTargetArr:l("t"),};function l(d){return function(){switch(d){case"s":return f;case"t":return m;default:return[1,2,3,4,5,6,7,8,0]}}}function v(w,d){w=w||f;d=d||m;return n(w)%2===n(d)%2}function g(d){var w=[];for(var x=0;x<9;x++){w[d[x]]=x}return w}function r(){p=[];u={sta:0,pos:0,step:0,visit:0};o={sta:0,pos:0,step:0,visit:0}}function t(){var y=f;for(var x=0;x<8;x++){var w=a(x,9);var d=y[w];y[w]=y[x];y[x]=d}return y}function a(d,w){return parseInt(Math.random()*(w-d)+d)}function n(d){var w=0;for(var x=1;x<=8;x++){w+=y(d,x)}return w;function y(A,z){var B=0;for(var C=0;C<9;C++){if(A[C]&&A[C]<z){B++}else{if(A[C]===z){break}}}return B}}function i(d,x){x.sta=0;for(var w=0;w<9;w++){if(d[w]!==0){x.sta|=((d[w]-1)<<(24-w*3))}else{x.pos=w;x.sta|=(d[w]<<(24-w*3))}}return 1}function b(x,d){for(var w=0;w<9;w++){if(x.pos!=w){d[w]=(x.sta>>(24-w*3))&7;d[w]++}else{d[w]=0}}}function e(x,y){var d=7<<((9-y)*3);var w={sta:0,pos:0,step:0,visit:0};w.sta=x.sta;d=d&x.sta;d=((d>>((9-y)*3))<<((9-x.pos-1)*3));w.sta|=d;w.sta&=~(7<<((9-y)*3));w.pos=y-1;return w}function k(x){var w=x.sta%q;var d=true;while(d){if(!p[w]){p[w]=p[w]||{sta:0,pos:0,step:0,visit:0};p[w].sta=x.sta;p[w].pos=x.pos;d=false}else{if(!(p[w].sta^x.sta)&&!(p[w].pos^x.pos)){d=false}else{w=(w+1)%q}}}return w}function j(z,C){r();var B=0;var d=[];var F;var E=0;var H=-1;var K=false;var I;var w;var J=[];C=C||m;z=z||f;m=C;f=z;i(C,u);i(z,o);h=(new Date()).getTime();B=k(o);d.push(B);B=k(u);d.push(B);p[B]=p[B]||{sta:0,pos:0,step:0,visit:0};p[B].visit=1;p[B].step=1;if(n(z)%2!==n(C)%2){return{solve:false}}if(!(o.sta^u.sta)&&!(o.pos^u.pos)){while(d.length){d.pop()}return{changePath:[C],stepNum:0,solve:true}}while(d.length&&!K){E++;F=d[0];for(var A=0;A<4;A++){if(s[p[F].pos][A]){var G=k(e(p[F],s[p[F].pos][A]));if(!p[G].step){p[G].step=p[F].step+1;p[G].visit=p[F].visit;d.push(G);J[G]=F}else{if(p[G].visit!==p[F].visit){I=G;w=F;K=true;H=(p[F].step+p[G].step)}}}}d.shift()}while(d.length){d.pop()}c=(new Date()).getTime();if(!K){return{solve:false,time:c-h,stateNum:E}}var x=[];D(I,J,x,true);D(w,J,x,false);var y={};i(x[0],y);if(y.sta===u.sta){x=x.reverse()}return{time:c-h,stateNum:E,stepNum:H,solve:true,path:x};function D(P,Q,R,M){var O=P;var N=false;while(1){var L=[];b(p[O],L);M?R.unshift(L):R.push(L);O=Q[O];if(!O||N){break}N=o.sta===p[O].sta}}}};
